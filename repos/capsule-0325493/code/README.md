# Identifying Predictors of Within-person Variance in MRI-based Brain Volume estimates -- Code and Data

This archive reproduces the results of Identifying predictors of within-person variance in MRI-based brain volume estimates (submitted).

To execute everything, press 'Run'. This executes `run.sh`, a shell script calling the R scripts which generade all figures as well as the document getAllNumbers, which extracts all numbers used. Click the 'Environments and Depdencies' (or 'Env') button to see details of the computational environment.

## Simulations

The simulations refered to in the paper can be found in code/08_simulations

## Format Result Files

As analysis rational we used a tree. The tree starts in the data folder. The different data files residing here are joined by the R function joinDataSources. The result is stored in the folder /data/joinDataSources within an RData file. In this folder, there is a folder called cleanData, which contains the results of applying the R function cleanData on the results stored in joinDataSoruces. We repeat this pattern.

The general rule is that the data that reside within folder X with parent folder Y are created by applying the R function X to the data in folder Y. The different .RData files refer to different versions of the function X. Each .RData  file contains excactly one variable named repres, with at least three slots: 

* `$res`: the result, obtained by applying function X to data in folder Y.
* `$call`: The full call to function X.
* `$func`: The full source code of function X at the time of the call
* `($helper`: The full source code of the main helper functions of function X)

The most current version of all functions used reside in the /code folder.

## Reproducing the Analysis

To fully reproduce a plot, one first has to locate the .RData file that contains the plotted data. For Figure 3, the plot of the correlations between the predictors (corrPlotPred.R), the .RData file is /data/joinDataSources/cleanData/calcICC/2.RData. Applying the helper function getVersions which resides in global.R returns


```
getVersions("/data/joinDataSources/cleanData/calcICC/2.RData")
$calcICC
[1] "data/joinDataSources/cleanData/calcICC/2.RData"

$cleanData
[1] "data/joinDataSources/cleanData/2.RData"

$joinDataSources
[1] "data/joinDataSources/1.RData"
```

That is, the file  in `.../calcICC/2.RData` was generated by applying the version of cleanData() that is saved in the variable `repres$func` in `.../calcICC/2.RData` to ``.../cleanData/2.RData`. `.../cleanData/2.RData` itself was generated by applying the version of `joinDataSources()` that is saved in `.../cleanData/2.RData` and so on.

This procedure can be applied for every plot to obtain the necessary information for reproducing it completely starting from the raw data. Because all plots depend on some common file at the start of the analysis tree, the script makeAllFigures.R returns all unique files that were used for making the plots. The information is stored in the variable usedFiles within the global R environment/workspace.

## Whom to contact:
Any and all questions can be directed to Julian Karch at j.d.karch@fsw.leidenuniv.nl



